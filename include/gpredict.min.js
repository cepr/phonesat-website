function get_orbit_type(a){var b=ORBIT_TYPE_UNKNOWN;return b=geostationary(a)?ORBIT_TYPE_GEO:decayed(a)?ORBIT_TYPE_DECAYED:ORBIT_TYPE_UNKNOWN}function geostationary(a){return 2E-4>fabs(a.meanmo-1.0027)?!0:!1}function decayed(a){return a.jul_epoch+(16.666666-a.meanmo)/(10*fabs(a.tle.xndt2o/(twopi/xmnpda/xmnpda)))<a.jul_utc?!0:!1}
function has_aos(a,b){var d=0,e=0,e=0,d=!1;0==a.meanmo?d=!1:(d=a.tle.xincl,d>=pio2&&(d=pi-d),e=331.25*Math.exp(Math.log(1440/a.meanmo)*(2/3)),e=e*(1+a.tle.eo)-xkmper,d=acos(xkmper/(e+xkmper))+d>fabs(b.lat*de2ra)?!0:!1);return d}
function Convert_Satellite_Data(a,b){b.sat_name=a[0];b.catnr=a[1].substr(2,5);b.idesg=a[1].substr(9,8);b.epoch=a[1].substr(18,14);b.epoch_year=a[1].substr(18,2);b.epoch_year+=2E3;b.epoch_day=a[1].substr(20,3);b.epoch_fod=a[1].substr(23,9);b.xndt2o=a[1].substr(33,10);b.xndd6o=a[1].substr(44,1)+"."+a[1].substr(45,5)+"E"+a[1].substr(50,2);b.bstar=a[1].substr(53,1)+"."+a[1].substr(54,5)+"E"+a[1].substr(59,2);b.elset=a[1].substr(64,4);b.xincl=a[2].substr(8,8);b.xnodeo=a[2].substr(17,8);b.eo="."+a[2].substr(26,
7);b.omegao=a[2].substr(34,8);b.xmo=a[2].substr(43,8);b.xno=a[2].substr(52,10);b.revnum=a[2].substr(63,5)}
function select_ephemeris(a){var b,d,e;a.tle.xnodeo*=de2ra;a.tle.omegao*=de2ra;a.tle.xmo*=de2ra;a.tle.xincl*=de2ra;d=twopi/xmnpda/xmnpda;a.meanmo=a.tle.xno;a.tle.xno=a.tle.xno*d*xmnpda;a.tle.xndt2o*=d;a.tle.xndd6o=a.tle.xndd6o*d/xmnpda;a.tle.bstar/=ae;d=xke/a.tle.xno;b=pow(d,tothrd);e=cos(a.tle.xincl);d=1-a.tle.eo*a.tle.eo;d=1.5*ck2*(3*e*e-1)/pow(d,1.5);e=d/(b*b);b*=1-e*(0.5*tothrd+e*(1.654320987654321*e+1));a.flags=0.15625<=twopi/(a.tle.xno/(d/(b*b)+1))/xmnpda?a.flags|DEEP_SPACE_EPHEM_FLAG:a.flags&
~DEEP_SPACE_EPHEM_FLAG}var ORBIT_TYPE_UNKNOWN=0,ORBIT_TYPE_LEO=1,ORBIT_TYPE_ICO=2,ORBIT_TYPE_GEO=3,ORBIT_TYPE_GSO=4,ORBIT_TYPE_MOLNIYA=5,ORBIT_TYPE_TUNDRA=6,ORBIT_TYPE_POLAR=7,ORBIT_TYPE_SUNSYNC=8,ORBIT_TYPE_DECAYED=9,OP_STAT_UNKNOWN=0,OP_STAT_OPERATIONAL=1,OP_STAT_NONOP=2,OP_STAT_PARTIAL=3,OP_STAT_STDBY=4,OP_STAT_SPARE=5,OP_STAT_EXTENDED=6;
function tle_t(){this.revnum=this.elset=this.catnr=this.xno=this.xmo=this.omegao=this.eo=this.xnodeo=this.xincl=this.bstar=this.xndd6o=this.xndt2o=this.epoch_fod=this.epoch_day=this.epoch_year=this.epoch=0;this.idesg=this.sat_name="";this.status=OP_STAT_UNKNOWN;this.omegao1=this.xnodeo1=this.xincl1=0}function geodetic_t(){this.theta=this.alt=this.lon=this.lat=0}function vector_t(){this.w=this.z=this.y=this.x=0}function obs_set_t(){this.range_rate=this.range=this.el=this.az=0}
function obs_astro_t(){this.dec=this.ra=0}function deep_arg_t(){this.ds50=this.t=this.xn=this.xinc=this.em=this.xnode=this.omgadf=this.xll=this.xnodp=this.xnodot=this.omgdot=this.xmdot=this.betao2=this.cosg=this.sing=this.theta2=this.aodp=this.betao=this.cosio=this.sinio=this.eosq=0}
function sgpsdp_static_t(){this.xlcof=this.xnodot=this.xnodcf=this.xmdot=this.xmcof=this.x7thm1=this.x3thm1=this.x1mth2=this.t5cof=this.t4cof=this.t3cof=this.t2cof=this.sinmo=this.xnodp=this.sinio=this.omgdot=this.eta=this.omgcof=this.delmo=this.d4=this.d3=this.d2=this.cosio=this.c5=this.c4=this.c1=this.aycof=this.aodp=0}
function deep_static_t(){this.zcosil=this.zsinil=this.zcoshl=this.zsinhl=this.zcosgl=this.zsingl=this.shs=this.pe=this.pinc=this.sh1=this.sghl=this.d2211=this.d2201=this.xli=this.sghs=this.pl=this.preep=this.step2=this.stepn=this.stepp=this.atime=this.xni=this.xfact=this.xlamo=this.fasx6=this.fasx4=this.fasx2=this.del3=this.del2=this.del1=this.d5433=this.d5421=this.d5232=this.d5220=this.d4422=this.d4410=this.d3222=this.d3210=this.ssh=this.ssl=this.sgh4=this.sl4=this.sh3=this.sgh3=this.sl3=this.si3=
this.se3=this.sh2=this.sgh2=this.sl2=this.si2=this.se2=this.xi3=this.ssg=this.ssi=this.sse=this.xh3=this.xh2=this.xgh4=this.xgh3=this.xgh2=this.xl4=this.xl3=this.xl2=this.xi2=this.e3=this.ee2=this.savtsn=this.zmos=this.zmol=this.omegaq=this.xqncl=this.xnq=this.thgr=0}
function sat_t(){this.website=this.nickname=this.name="";this.tle=new tle_t;this.flags=0;this.sgps=new sgpsdp_static_t;this.dps=new deep_static_t;this.deep_arg=new deep_arg_t;this.pos=new vector_t;this.vel=new vector_t;this.bearing=new obs_set_t;this.astro=new obs_astro_t;this.orbit=this.meanmo=this.phase=this.footprint=this.ma=this.velo=this.alt=this.ssplon=this.ssplat=this.dec=this.ra=this.range_rate=this.range=this.el=this.az=this.los=this.aos=this.tsince=this.jul_utc=this.jul_epoch=0;this.otype=
ORBIT_TYPE_UNKNOWN}
var de2ra=0.0174532925,pi=3.1415926535898,pio2=1.5707963267949,x3pio2=4.71238898,twopi=6.2831853071796,e6a=1E-6,tothrd=0.66666667,xj2=0.0010826158,xj3=-2.53881E-6,xj4=-1.65597E-6,xke=0.0743669161,xkmper=6378.135,xmnpda=1440,ae=1,ck2=5.413079E-4,ck4=6.209887E-7,__f=0.003352779,ge=398600.8,__s__=1.012229,qoms2t=1.880279E-9,secday=86400,omega_E=1.0027379,omega_ER=6.3003879,zns=1.19459E-5,c1ss=2.9864797E-6,zes=0.01675,znl=1.5835218E-4,c1l=4.7968065E-7,zel=0.0549,zcosis=0.91744867,zsinis=0.39785416,zsings=
-0.98088458,zcosgs=0.1945905,zcoshs=1,zsinhs=0,q22=1.7891679E-6,q31=2.1460748E-6,q33=2.2123015E-7,g22=5.7686396,g32=0.95240898,g44=1.8014998,g52=1.050833,g54=4.4108898,root22=1.7891679E-6,root32=3.7393792E-7,root44=7.3636953E-9,root52=1.1428639E-7,root54=2.1765803E-9,thdt=0.0043752691,rho=0.15696615,mfactor=7.292115E-5,__sr__=696E3,AU=149597870,dpinit=1,dpsec=2,dpper=3,CR=10,LF=13,ALL_FLAGS=-1,SGP_INITIALIZED_FLAG=1,SGP4_INITIALIZED_FLAG=2,SDP4_INITIALIZED_FLAG=4,SGP8_INITIALIZED_FLAG=8,SDP8_INITIALIZED_FLAG=
16,SIMPLE_FLAG=32,DEEP_SPACE_EPHEM_FLAG=64,LUNAR_TERMS_DONE_FLAG=128,NEW_EPHEMERIS_FLAG=256,DO_LOOP_FLAG=512,RESONANCE_FLAG=1024,SYNCHRONOUS_FLAG=2048,EPOCH_RESTART_FLAG=4096,VISIBLE_FLAG=8192,SAT_ECLIPSED_FLAG=16384;
function SGP4(a,b){var d,e,c,f,g,l,n,t,p,q,k,r,h,m,s,y,u,x,w;~a.flags&SGP4_INITIALIZED_FLAG&&(a.flags|=SGP4_INITIALIZED_FLAG,u=pow(xke/a.tle.xno,tothrd),a.sgps.cosio=Math.cos(a.tle.xincl),w=a.sgps.cosio*a.sgps.cosio,a.sgps.x3thm1=3*w-1,x=a.tle.eo*a.tle.eo,x=1-x,y=Math.sqrt(x),h=1.5*ck2*a.sgps.x3thm1/(u*u*y*x),u*=1-h*(0.5*tothrd+h*(1+134/81*h)),h=1.5*ck2*a.sgps.x3thm1/(u*u*y*x),a.sgps.xnodp=a.tle.xno/(1+h),a.sgps.aodp=u/(1-h),a.flags=a.sgps.aodp*(1-a.tle.eo)/ae<220/xkmper+ae?a.flags|SIMPLE_FLAG:a.flags&
~SIMPLE_FLAG,u=__s__,r=qoms2t,h=(a.sgps.aodp*(1-a.tle.eo)-ae)*xkmper,156>h&&(u=98>=h?20:h-78,r=pow((120-u)*ae/xkmper,4),u=u/xkmper+ae),s=1/(a.sgps.aodp*a.sgps.aodp*x*x),e=1/(a.sgps.aodp-u),a.sgps.eta=a.sgps.aodp*a.tle.eo*e,h=a.sgps.eta*a.sgps.eta,m=a.tle.eo*a.sgps.eta,c=fabs(1-h),r*=pow(e,4),p=r/pow(c,3.5),d=p*a.sgps.xnodp*(a.sgps.aodp*(1+1.5*h+m*(4+h))+0.75*ck2*e/c*a.sgps.x3thm1*(8+3*h*(8+h))),a.sgps.c1=d*a.tle.bstar,a.sgps.sinio=Math.sin(a.tle.xincl),d=-xj3/ck2*pow(ae,3),t=r*e*d*a.sgps.xnodp*ae*
a.sgps.sinio/a.tle.eo,a.sgps.x1mth2=1-w,a.sgps.c4=2*a.sgps.xnodp*p*a.sgps.aodp*x*(a.sgps.eta*(2+0.5*h)+a.tle.eo*(0.5+2*h)-2*ck2*e/(a.sgps.aodp*c)*(-3*a.sgps.x3thm1*(1-2*m+h*(1.5-0.5*m))+0.75*a.sgps.x1mth2*(2*h-m*(1+h))*Math.cos(2*a.tle.omegao))),a.sgps.c5=2*p*a.sgps.aodp*x*(1+2.75*(h+m)+m*h),p=w*w,c=3*ck2*s*a.sgps.xnodp,h=c*ck2*s,s=1.25*ck4*s*s*a.sgps.xnodp,a.sgps.xmdot=a.sgps.xnodp+0.5*c*y*a.sgps.x3thm1+0.0625*h*y*(13-78*w+137*p),a.sgps.omgdot=-0.5*c*(1-5*w)+0.0625*h*(7-114*w+395*p)+s*(3-36*w+49*
p),y=-c*a.sgps.cosio,a.sgps.xnodot=y+(0.5*h*(4-19*w)+2*s*(3-7*w))*a.sgps.cosio,a.sgps.omgcof=a.tle.bstar*t*Math.cos(a.tle.omegao),a.sgps.xmcof=-tothrd*r*a.tle.bstar*ae/m,a.sgps.xnodcf=3.5*x*y*a.sgps.c1,a.sgps.t2cof=1.5*a.sgps.c1,a.sgps.xlcof=0.125*d*a.sgps.sinio*(3+5*a.sgps.cosio)/(1+a.sgps.cosio),a.sgps.aycof=0.25*d*a.sgps.sinio,a.sgps.delmo=pow(1+a.sgps.eta*Math.cos(a.tle.xmo),3),a.sgps.sinmo=Math.sin(a.tle.xmo),a.sgps.x7thm1=7*w-1,~a.flags&SIMPLE_FLAG&&(w=a.sgps.c1*a.sgps.c1,a.sgps.d2=4*a.sgps.aodp*
e*w,s=a.sgps.d2*e*a.sgps.c1/3,a.sgps.d3=(17*a.sgps.aodp+u)*s,a.sgps.d4=0.5*s*a.sgps.aodp*e*(221*a.sgps.aodp+31*u)*a.sgps.c1,a.sgps.t3cof=a.sgps.d2+2*w,a.sgps.t4cof=0.25*(3*a.sgps.d3+a.sgps.c1*(12*a.sgps.d2+10*w)),a.sgps.t5cof=0.2*(3*a.sgps.d4+12*a.sgps.c1*a.sgps.d3+6*a.sgps.d2*a.sgps.d2+15*w*(2*a.sgps.d2+w))));r=a.tle.xmo+a.sgps.xmdot*b;w=a.tle.omegao+a.sgps.omgdot*b;x=a.tle.xnodeo+a.sgps.xnodot*b;y=w;c=r;e=b*b;x+=a.sgps.xnodcf*e;m=1-a.sgps.c1*b;h=a.tle.bstar*a.sgps.c4*b;u=a.sgps.t2cof*e;~a.flags&
SIMPLE_FLAG&&(c=a.sgps.omgcof*b,y=a.sgps.xmcof*(pow(1+a.sgps.eta*Math.cos(r),3)-a.sgps.delmo),s=c+y,c=r+s,y=w-s,r=e*b,s=b*r,m=m-a.sgps.d2*e-a.sgps.d3*r-a.sgps.d4*s,h+=a.tle.bstar*a.sgps.c5*(sin(c)-a.sgps.sinmo),u=u+a.sgps.t3cof*r+s*(a.sgps.t4cof+b*a.sgps.t5cof));m=a.sgps.aodp*pow(m,2);h=a.tle.eo-h;u=c+y+x+a.sgps.xnodp*u;c=Math.sqrt(1-h*h);e=xke/pow(m,1.5);r=h*Math.cos(y);s=1/(m*c*c);d=s*a.sgps.xlcof*r;c=s*a.sgps.aycof;u+=d;k=h*Math.sin(y)+c;h=p=FMod2p(u-x);l=0;do{q=Math.sin(h);f=Math.cos(h);s=r*q;
g=k*f;c=r*f;d=k*q;t=(p-g+s-h)/(1-c-d)+h;if(fabs(t-h)<=e6a)break;h=t}while(10>l++);l=s-g;s=1-(r*r+k*k);p=m*s;g=m*(1-(c+d));c=1/g;t=xke*Math.sqrt(m)*l*c;d=xke*Math.sqrt(p)*c;h=m*c;m=Math.sqrt(s);s=1/(1+m);c=h*(f-r+k*l*s);h*=q-k-r*l*s;k=AcTan(h,c);r=2*h*c;q=2*c*c-1;s=1/p;c=ck2*s;h=c*s;s=g*(1-1.5*h*m*a.sgps.x3thm1)+0.5*c*a.sgps.x1mth2*q;p=k-0.25*h*a.sgps.x7thm1*r;m=x+1.5*h*a.sgps.cosio*r;h=a.tle.xincl+1.5*h*a.sgps.cosio*a.sgps.sinio*q;r=t-e*c*a.sgps.x1mth2*r;c=d+e*c*(a.sgps.x1mth2*q+1.5*a.sgps.x3thm1);
e=Math.sin(p);d=Math.cos(p);k=Math.sin(h);f=Math.cos(h);q=Math.sin(m);p=Math.cos(m);t=-q*f;n=p*f;f=t*e+p*d;g=n*e+q*d;l=k*e;a.pos.x=s*f;a.pos.y=s*g;a.pos.z=s*l;a.vel.x=r*f+c*(t*d-p*e);a.vel.y=r*g+c*(n*d-q*e);a.vel.z=r*l+c*k*d;a.phase=u-x-w+twopi;0>a.phase&&(a.phase+=twopi);a.phase=FMod2p(a.phase);a.tle.omegao1=y;a.tle.xincl1=h;a.tle.xnodeo1=m}
function SDP4(a,b){var d,e,c,f,g,l,n,t,p,q,k,r,h,m;~a.flags&SDP4_INITIALIZED_FLAG&&(a.flags|=SDP4_INITIALIZED_FLAG,m=pow(xke/a.tle.xno,tothrd),a.deep_arg.cosio=Math.cos(a.tle.xincl),a.deep_arg.theta2=a.deep_arg.cosio*a.deep_arg.cosio,a.sgps.x3thm1=3*a.deep_arg.theta2-1,a.deep_arg.eosq=a.tle.eo*a.tle.eo,a.deep_arg.betao2=1-a.deep_arg.eosq,a.deep_arg.betao=Math.sqrt(a.deep_arg.betao2),g=1.5*ck2*a.sgps.x3thm1/(m*m*a.deep_arg.betao*a.deep_arg.betao2),m*=1-g*(0.5*tothrd+g*(1+134/81*g)),g=1.5*ck2*a.sgps.x3thm1/
(m*m*a.deep_arg.betao*a.deep_arg.betao2),a.deep_arg.xnodp=a.tle.xno/(1+g),a.deep_arg.aodp=m/(1-g),g=__s__,e=qoms2t,m=(a.deep_arg.aodp*(1-a.tle.eo)-ae)*xkmper,156>m&&(g=98>=m?20:m-78,e=pow((120-g)*ae/xkmper,4),g=g/xkmper+ae),m=1/(a.deep_arg.aodp*a.deep_arg.aodp*a.deep_arg.betao2*a.deep_arg.betao2),a.deep_arg.sing=Math.sin(a.tle.omegao),a.deep_arg.cosg=Math.cos(a.tle.omegao),p=1/(a.deep_arg.aodp-g),q=a.deep_arg.aodp*a.tle.eo*p,c=q*q,g=a.tle.eo*q,k=fabs(1-c),e*=pow(p,4),d=e/pow(k,3.5),e=d*a.deep_arg.xnodp*
(a.deep_arg.aodp*(1+1.5*c+g*(4+c))+0.75*ck2*p/k*a.sgps.x3thm1*(8+3*c*(8+c))),a.sgps.c1=a.tle.bstar*e,a.deep_arg.sinio=Math.sin(a.tle.xincl),e=-xj3/ck2*pow(ae,3),a.sgps.x1mth2=1-a.deep_arg.theta2,a.sgps.c4=2*a.deep_arg.xnodp*d*a.deep_arg.aodp*a.deep_arg.betao2*(q*(2+0.5*c)+a.tle.eo*(0.5+2*c)-2*ck2*p/(a.deep_arg.aodp*k)*(-3*a.sgps.x3thm1*(1-2*g+c*(1.5-0.5*g))+0.75*a.sgps.x1mth2*(2*c-g*(1+c))*Math.cos(2*a.tle.omegao))),c=a.deep_arg.theta2*a.deep_arg.theta2,q=3*ck2*m*a.deep_arg.xnodp,g=q*ck2*m,p=1.25*
ck4*m*m*a.deep_arg.xnodp,a.deep_arg.xmdot=a.deep_arg.xnodp+0.5*q*a.deep_arg.betao*a.sgps.x3thm1+0.0625*g*a.deep_arg.betao*(13-78*a.deep_arg.theta2+137*c),m=1-5*a.deep_arg.theta2,a.deep_arg.omgdot=-0.5*q*m+0.0625*g*(7-114*a.deep_arg.theta2+395*c)+p*(3-36*a.deep_arg.theta2+49*c),m=-q*a.deep_arg.cosio,a.deep_arg.xnodot=m+(0.5*g*(4-19*a.deep_arg.theta2)+2*p*(3-7*a.deep_arg.theta2))*a.deep_arg.cosio,a.sgps.xnodcf=3.5*a.deep_arg.betao2*m*a.sgps.c1,a.sgps.t2cof=1.5*a.sgps.c1,a.sgps.xlcof=0.125*e*a.deep_arg.sinio*
(3+5*a.deep_arg.cosio)/(1+a.deep_arg.cosio),a.sgps.aycof=0.25*e*a.deep_arg.sinio,a.sgps.x7thm1=7*a.deep_arg.theta2-1,Deep(dpinit,a));m=a.tle.xmo+a.deep_arg.xmdot*b;a.deep_arg.omgadf=a.tle.omegao+a.deep_arg.omgdot*b;g=a.tle.xnodeo+a.deep_arg.xnodot*b;e=b*b;a.deep_arg.xnode=g+a.sgps.xnodcf*e;c=1-a.sgps.c1*b;g=a.tle.bstar*a.sgps.c4*b;q=a.sgps.t2cof*e;a.deep_arg.xn=a.deep_arg.xnodp;a.deep_arg.xll=m;a.deep_arg.t=b;Deep(dpsec,a);m=a.deep_arg.xll;e=pow(xke/a.deep_arg.xn,tothrd)*c*c;a.deep_arg.em-=g;m+=a.deep_arg.xnodp*
q;a.deep_arg.xll=m;Deep(dpper,a);m=a.deep_arg.xll;m=m+a.deep_arg.omgadf+a.deep_arg.xnode;g=Math.sqrt(1-a.deep_arg.em*a.deep_arg.em);a.deep_arg.xn=xke/pow(e,1.5);c=a.deep_arg.em*Math.cos(a.deep_arg.omgadf);p=1/(e*g*g);q=p*a.sgps.xlcof*c;g=p*a.sgps.aycof;m+=q;f=a.deep_arg.em*Math.sin(a.deep_arg.omgadf)+g;g=l=FMod2p(m-a.deep_arg.xnode);d=0;do{t=Math.sin(g);n=Math.cos(g);p=c*t;h=f*n;q=c*n;k=f*t;r=(l-h+p-g)/(1-q-k)+g;if(fabs(r-g)<=e6a)break;g=r}while(10>d++);h=p-h;p=1-(c*c+f*f);l=e*p;r=e*(1-(q+k));q=1/
r;d=xke*Math.sqrt(e)*h*q;k=xke*Math.sqrt(l)*q;g=e*q;e=Math.sqrt(p);p=1/(1+e);q=g*(n-c+f*h*p);g*=t-f-c*h*p;t=AcTan(g,q);f=2*g*q;c=2*q*q-1;p=1/l;q=ck2*p;g=q*p;e=r*(1-1.5*g*e*a.sgps.x3thm1)+0.5*q*a.sgps.x1mth2*c;t-=0.25*g*a.sgps.x7thm1*f;p=a.deep_arg.xnode+1.5*g*a.deep_arg.cosio*f;l=a.deep_arg.xinc+1.5*g*a.deep_arg.cosio*a.deep_arg.sinio*c;g=d-a.deep_arg.xn*q*a.sgps.x1mth2*f;q=k+a.deep_arg.xn*q*(a.sgps.x1mth2*c+1.5*a.sgps.x3thm1);c=Math.sin(t);k=Math.cos(t);d=Math.sin(l);t=Math.cos(l);f=Math.sin(p);
p=Math.cos(p);l=-f*t;h=p*t;t=l*c+p*k;n=h*c+f*k;r=d*c;a.pos.x=e*t;a.pos.y=e*n;a.pos.z=e*r;a.vel.x=g*t+q*(l*k-p*c);a.vel.y=g*n+q*(h*k-f*c);a.vel.z=g*r+q*d*k;a.phase=m-a.deep_arg.xnode-a.deep_arg.omgadf+twopi;0>a.phase&&(a.phase+=twopi);a.phase=FMod2p(a.phase);a.tle.omegao1=a.deep_arg.omgadf;a.tle.xincl1=a.deep_arg.xinc;a.tle.xnodeo1=a.deep_arg.xnode}
function Deep(a,b){var d,e,c,f,g,l,n,t,p,q,k,r,h,m,s,y,u,x,w,Ya,L,ra,Za,M,$a,Ea,sa,ta,ua,Fa,ab,N,bb,cb,db,A,v,C,ga,eb,D,fb,gb,Ga,V,hb,ib,jb,kb,lb,mb,nb,ob,Ha,ha,O,va,P,Q,W,pb,qb,rb,Ia,sb,tb,wa,ub,ia,Ja,Ka,La,Ma,Na,Oa,Pa,Qa,xa,E,vb,Ra,wb,xb,ya,z,F,G,H,K,ja,I,J,ka,la,ma,na,Sa,za,Ta,X,Y,yb,Aa,zb,B,Ab,Z,Ua,Bb,Va,oa,Wa,Cb,Xa,$,pa,Ba,qa,Ca,aa,ba,R,S,ca,Da,T,da,ea,fa=0,U=0;switch(a){case dpinit:b.dps.thgr=ThetaG(b.tle.epoch,b.deep_arg);v=b.tle.eo;b.dps.xnq=b.deep_arg.xnodp;h=1/b.deep_arg.aodp;b.dps.xqncl=
b.tle.xincl;Ta=b.tle.xmo;Ab=b.deep_arg.omgdot+b.deep_arg.xnodot;xa=Math.sin(b.tle.xnodeo);ua=Math.cos(b.tle.xnodeo);b.dps.omegaq=b.tle.omegao;b.dps.preep=0;L=b.deep_arg.ds50+18261.5;L!=b.dps.preep&&(b.dps.preep=L,Aa=4.523602-9.2422029E-4*L,ya=Math.sin(Aa),Fa=Math.cos(Aa),b.dps.zcosil=0.91375164-0.03568096*Fa,b.dps.zsinil=Math.sqrt(1-b.dps.zcosil*b.dps.zcosil),b.dps.zsinhl=0.089683511*ya/b.dps.zsinil,b.dps.zcoshl=Math.sqrt(1-b.dps.zsinhl*b.dps.zsinhl),$a=4.7199672+0.2299715*L,Qa=5.8351514+0.001944368*
L,b.dps.zmol=FMod2p($a-Qa),N=0.39785416*ya/b.dps.zsinil,bb=b.dps.zcoshl*Fa+0.91744867*b.dps.zsinhl*ya,N=AcTan(N,bb),N=Qa+N-Aa,b.dps.zcosgl=Math.cos(N),b.dps.zsingl=Math.sin(N),b.dps.zmos=6.2565837+0.017201977*L,b.dps.zmos=FMod2p(b.dps.zmos));b.dps.savtsn=1E20;T=zcosgs;S=zsings;ea=zcosis;Da=zsinis;da=ua;ca=xa;Ea=c1ss;R=zns;Ca=zes;zmo=b.dps.zmos;for(zb=1/b.dps.xnq;;){d=T*da+S*ea*ca;c=-S*da+T*ea*ca;n=-T*ca+S*ea*da;t=S*Da;p=S*ca+T*ea*da;q=T*Da;e=b.deep_arg.cosio*n+b.deep_arg.sinio*t;f=b.deep_arg.cosio*
p+b.deep_arg.sinio*q;g=-b.deep_arg.sinio*n+b.deep_arg.cosio*t;l=-b.deep_arg.sinio*p+b.deep_arg.cosio*q;G=d*b.deep_arg.cosg+e*b.deep_arg.sing;H=c*b.deep_arg.cosg+f*b.deep_arg.sing;I=-d*b.deep_arg.sing+e*b.deep_arg.cosg;J=-c*b.deep_arg.sing+f*b.deep_arg.cosg;ka=g*b.deep_arg.sing;la=l*b.deep_arg.sing;ma=g*b.deep_arg.cosg;na=l*b.deep_arg.cosg;pa=12*G*G-3*I*I;Ba=24*G*H-6*I*J;qa=12*H*H-3*J*J;Z=3*(d*d+e*e)+pa*b.deep_arg.eosq;oa=6*(d*c+e*f)+Ba*b.deep_arg.eosq;$=3*(c*c+f*f)+qa*b.deep_arg.eosq;Ua=-6*d*g+b.deep_arg.eosq*
(-24*G*ma-6*I*ka);Bb=-6*(d*l+c*g)+b.deep_arg.eosq*(-24*(H*ma+G*na)-6*(I*la+J*ka));Va=-6*c*l+b.deep_arg.eosq*(-24*H*na-6*J*la);Wa=6*e*g+b.deep_arg.eosq*(24*G*ka-6*I*ma);Cb=6*(f*g+e*l)+b.deep_arg.eosq*(24*(H*ka+G*la)-6*(J*ma+I*na));Xa=6*f*l+b.deep_arg.eosq*(24*H*la-6*J*na);Z=Z+Z+b.deep_arg.betao2*pa;oa=oa+oa+b.deep_arg.betao2*Ba;$=$+$+b.deep_arg.betao2*qa;Q=Ea*zb;P=-0.5*Q/b.deep_arg.betao;W=Q*b.deep_arg.betao;va=-15*v*W;pb=G*I+H*J;qb=H*I+G*J;rb=H*J-G*I;Ia=va*R*pb;w=P*R*(Ua+Va);Ra=-R*Q*(Z+$-14-6*b.deep_arg.eosq);
m=W*R*(pa+qa-6);x=-R*P*(Wa+Xa);0.052359877>b.dps.xqncl&&(x=0);b.dps.ee2=2*va*qb;b.dps.e3=2*va*rb;b.dps.xi2=2*P*Bb;b.dps.xi3=2*P*(Va-Ua);b.dps.xl2=-2*Q*oa;b.dps.xl3=-2*Q*($-Z);b.dps.xl4=-2*Q*(-21-9*b.deep_arg.eosq)*Ca;b.dps.xgh2=2*W*Ba;b.dps.xgh3=2*W*(qa-pa);b.dps.xgh4=-18*W*Ca;b.dps.xh2=-2*P*Cb;b.dps.xh3=-2*P*(Xa-Wa);if(b.flags&LUNAR_TERMS_DONE_FLAG)break;b.dps.sse=Ia;b.dps.ssi=w;b.dps.ssl=Ra;b.dps.ssh=x/b.deep_arg.sinio;b.dps.ssg=m-b.deep_arg.cosio*b.dps.ssh;b.dps.se2=b.dps.ee2;b.dps.si2=b.dps.xi2;
b.dps.sl2=b.dps.xl2;b.dps.sgh2=b.dps.xgh2;b.dps.sh2=b.dps.xh2;b.dps.se3=b.dps.e3;b.dps.si3=b.dps.xi3;b.dps.sl3=b.dps.xl3;b.dps.sgh3=b.dps.xgh3;b.dps.sh3=b.dps.xh3;b.dps.sl4=b.dps.xl4;b.dps.sgh4=b.dps.xgh4;T=b.dps.zcosgl;S=b.dps.zsingl;ea=b.dps.zcosil;Da=b.dps.zsinil;da=b.dps.zcoshl*ua+b.dps.zsinhl*xa;ca=xa*b.dps.zcoshl-ua*b.dps.zsinhl;R=znl;Ea=c1l;Ca=zel;zmo=b.dps.zmol;b.flags|=LUNAR_TERMS_DONE_FLAG}b.dps.sse+=Ia;b.dps.ssi+=w;b.dps.ssl+=Ra;b.dps.ssg=b.dps.ssg+m-b.deep_arg.cosio/b.deep_arg.sinio*x;
b.dps.ssh+=x/b.deep_arg.sinio;b.flags&=~RESONANCE_FLAG;b.flags&=~SYNCHRONOUS_FLAG;if(0.0052359877>b.dps.xnq&&0.0034906585<b.dps.xnq)b.flags|=RESONANCE_FLAG,b.flags|=SYNCHRONOUS_FLAG,nb=1+b.deep_arg.eosq*(-2.5+0.8125*b.deep_arg.eosq),ia=1+2*b.deep_arg.eosq,ub=1+b.deep_arg.eosq*(-6+6.60937*b.deep_arg.eosq),ga=0.75*(1+b.deep_arg.cosio)*(1+b.deep_arg.cosio),fb=0.9375*b.deep_arg.sinio*b.deep_arg.sinio*(1+3*b.deep_arg.cosio)-0.75*(1+b.deep_arg.cosio),V=1+b.deep_arg.cosio,V*=1.875*V*V,b.dps.del1=3*b.dps.xnq*
b.dps.xnq*h*h,b.dps.del2=2*b.dps.del1*ga*nb*q22,b.dps.del3=3*b.dps.del1*V*ub*q33*h,b.dps.del1=b.dps.del1*fb*ia*q31*h,b.dps.fasx2=0.13130908,b.dps.fasx4=2.8843198,b.dps.fasx6=0.37448087,b.dps.xlamo=Ta+b.tle.xnodeo+b.tle.omegao-b.dps.thgr,M=b.deep_arg.xmdot+Ab-thdt,M=M+b.dps.ssl+b.dps.ssg+b.dps.ssh;else{if(0.00826>b.dps.xnq||0.00924<b.dps.xnq)break;if(0.5>v)break;b.flags|=RESONANCE_FLAG;A=v*b.deep_arg.eosq;ob=-0.306-0.44*(v-0.64);0.65>=v?(Ha=3.616-13.247*v+16.29*b.deep_arg.eosq,ia=-19.302+117.39*v-
228.419*b.deep_arg.eosq+156.591*A,Ja=-18.9068+109.7927*v-214.6334*b.deep_arg.eosq+146.5816*A,Ka=-41.122+242.694*v-471.094*b.deep_arg.eosq+313.953*A,La=-146.407+841.88*v-1629.014*b.deep_arg.eosq+1083.435*A,Ma=-532.114+3017.977*v-5740*b.deep_arg.eosq+3708.276*A):(Ha=-72.099+331.819*v-508.738*b.deep_arg.eosq+266.724*A,ia=-346.844+1582.851*v-2415.925*b.deep_arg.eosq+1246.113*A,Ja=-342.585+1554.908*v-2366.899*b.deep_arg.eosq+1215.972*A,Ka=-1052.797+4758.686*v-7193.992*b.deep_arg.eosq+3651.957*A,La=-3581.69+
16178.11*v-24462.77*b.deep_arg.eosq+12422.52*A,Ma=0.715>=v?1464.74-4664.75*v+3763.64*b.deep_arg.eosq:-5149.66+29936.92*v-54087.36*b.deep_arg.eosq+31324.56*A);0.7>v?(Pa=-919.2277+4988.61*v-9064.77*b.deep_arg.eosq+5542.21*A,Na=-822.71072+4568.6173*v-8491.4146*b.deep_arg.eosq+5337.524*A,Oa=-853.666+4690.25*v-8624.77*b.deep_arg.eosq+5341.4*A):(Pa=-37995.78+161616.52*v-229838.2*b.deep_arg.eosq+109377.94*A,Na=-51752.104+218913.95*v-309468.16*b.deep_arg.eosq+146349.42*A,Oa=-40023.88+170470.89*v-242699.48*
b.deep_arg.eosq+115605.82*A);s=b.deep_arg.sinio*b.deep_arg.sinio;ga=0.75*(1+2*b.deep_arg.cosio+b.deep_arg.theta2);eb=1.5*s;gb=1.875*b.deep_arg.sinio*(1-2*b.deep_arg.cosio-3*b.deep_arg.theta2);ab=-1.875*b.deep_arg.sinio*(1+2*b.deep_arg.cosio-3*b.deep_arg.theta2);hb=35*s*ga;ib=39.375*s*s;jb=9.84375*b.deep_arg.sinio*(s*(1-2*b.deep_arg.cosio-5*b.deep_arg.theta2)+0.33333333*(-2+4*b.deep_arg.cosio+6*b.deep_arg.theta2));kb=b.deep_arg.sinio*(4.92187512*s*(-2-4*b.deep_arg.cosio+10*b.deep_arg.theta2)+6.56250012*
(1+2*b.deep_arg.cosio-3*b.deep_arg.theta2));lb=29.53125*b.deep_arg.sinio*(2-8*b.deep_arg.cosio+b.deep_arg.theta2*(-12+8*b.deep_arg.cosio+10*b.deep_arg.theta2));mb=29.53125*b.deep_arg.sinio*(-2-8*b.deep_arg.cosio+b.deep_arg.theta2*(12+8*b.deep_arg.cosio-10*b.deep_arg.theta2));yb=b.dps.xnq*b.dps.xnq;k=h*h;F=3*yb*k;z=F*root22;b.dps.d2201=z*ga*ob;b.dps.d2211=z*eb*Ha;F*=h;z=F*root32;b.dps.d3210=z*gb*ia;b.dps.d3222=z*ab*Ja;F*=h;z=2*F*root44;b.dps.d4410=z*hb*Ka;b.dps.d4422=z*ib*La;F*=h;z=F*root52;b.dps.d5220=
z*jb*Ma;b.dps.d5232=z*kb*Oa;z=2*F*root54;b.dps.d5421=z*lb*Na;b.dps.d5433=z*mb*Pa;b.dps.xlamo=Ta+b.tle.xnodeo+b.tle.xnodeo-b.dps.thgr-b.dps.thgr;M=b.deep_arg.xmdot+b.deep_arg.xnodot+b.deep_arg.xnodot-thdt-thdt;M=M+b.dps.ssl+b.dps.ssh+b.dps.ssh}b.dps.xfact=M-b.dps.xnq;b.dps.xli=b.dps.xlamo;b.dps.xni=b.dps.xnq;b.dps.atime=0;b.dps.stepp=720;b.dps.stepn=-720;b.dps.step2=259200;break;case dpsec:b.deep_arg.xll+=b.dps.ssl*b.deep_arg.t;b.deep_arg.omgadf+=b.dps.ssg*b.deep_arg.t;b.deep_arg.xnode+=b.dps.ssh*
b.deep_arg.t;b.deep_arg.em=b.tle.eo+b.dps.sse*b.deep_arg.t;b.deep_arg.xinc=b.tle.xincl+b.dps.ssi*b.deep_arg.t;0>b.deep_arg.xinc&&(b.deep_arg.xinc=-b.deep_arg.xinc,b.deep_arg.xnode+=pi,b.deep_arg.omgadf-=pi);if(~b.flags&RESONANCE_FLAG)break;do{0==b.dps.atime||0<=b.deep_arg.t&&0>b.dps.atime||0>b.deep_arg.t&&0<=b.dps.atime?(fa=0<=b.deep_arg.t?b.dps.stepp:b.dps.stepn,b.dps.atime=0,b.dps.xni=b.dps.xnq,b.dps.xli=b.dps.xlamo):fabs(b.deep_arg.t)>=fabs(b.dps.atime)&&(fa=0<b.deep_arg.t?b.dps.stepp:b.dps.stepn);
do fabs(b.deep_arg.t-b.dps.atime)>=b.dps.stepp?(b.flags|=DO_LOOP_FLAG,b.flags&=~EPOCH_RESTART_FLAG):(U=b.deep_arg.t-b.dps.atime,b.flags&=~DO_LOOP_FLAG),fabs(b.deep_arg.t)<fabs(b.dps.atime)&&(fa=0<=b.deep_arg.t?b.dps.stepn:b.dps.stepp,b.flags|=DO_LOOP_FLAG|EPOCH_RESTART_FLAG),b.flags&SYNCHRONOUS_FLAG?(Y=b.dps.del1*Math.sin(b.dps.xli-b.dps.fasx2)+b.dps.del2*Math.sin(2*(b.dps.xli-b.dps.fasx4))+b.dps.del3*Math.sin(3*(b.dps.xli-b.dps.fasx6)),X=b.dps.del1*Math.cos(b.dps.xli-b.dps.fasx2)+2*b.dps.del2*Math.cos(2*
(b.dps.xli-b.dps.fasx4))+3*b.dps.del3*Math.cos(3*(b.dps.xli-b.dps.fasx6))):(B=b.dps.omegaq+b.deep_arg.omgdot*b.dps.atime,ja=B+B,K=b.dps.xli+b.dps.xli,Y=b.dps.d2201*Math.sin(ja+b.dps.xli-g22)+b.dps.d2211*Math.sin(b.dps.xli-g22)+b.dps.d3210*Math.sin(B+b.dps.xli-g32)+b.dps.d3222*Math.sin(-B+b.dps.xli-g32)+b.dps.d4410*Math.sin(ja+K-g44)+b.dps.d4422*Math.sin(K-g44)+b.dps.d5220*Math.sin(B+b.dps.xli-g52)+b.dps.d5232*Math.sin(-B+b.dps.xli-g52)+b.dps.d5421*Math.sin(B+K-g54)+b.dps.d5433*Math.sin(-B+K-g54),
X=b.dps.d2201*Math.cos(ja+b.dps.xli-g22)+b.dps.d2211*Math.cos(b.dps.xli-g22)+b.dps.d3210*Math.cos(B+b.dps.xli-g32)+b.dps.d3222*Math.cos(-B+b.dps.xli-g32)+b.dps.d5220*Math.cos(B+b.dps.xli-g52)+b.dps.d5232*Math.cos(-B+b.dps.xli-g52)+2*(b.dps.d4410*Math.cos(ja+K-g44)+b.dps.d4422*Math.cos(K-g44)+b.dps.d5421*Math.cos(B+K-g54)+b.dps.d5433*Math.cos(-B+K-g54))),za=b.dps.xni+b.dps.xfact,X*=za,b.flags&DO_LOOP_FLAG&&(b.dps.xli=b.dps.xli+za*fa+Y*b.dps.step2,b.dps.xni=b.dps.xni+Y*fa+X*b.dps.step2,b.dps.atime+=
fa);while(b.flags&DO_LOOP_FLAG&&~b.flags&EPOCH_RESTART_FLAG)}while(b.flags&DO_LOOP_FLAG&&b.flags&EPOCH_RESTART_FLAG);b.deep_arg.xn=b.dps.xni+Y*U+0.5*X*U*U;Sa=b.dps.xli+za*U+0.5*Y*U*U;z=-b.deep_arg.xnode+b.dps.thgr+b.deep_arg.t*thdt;b.deep_arg.xll=~b.flags&SYNCHRONOUS_FLAG?Sa+z+z:Sa-b.deep_arg.omgadf+z;break;case dpper:y=Math.sin(b.deep_arg.xinc),sa=Math.cos(b.deep_arg.xinc),30<=fabs(b.dps.savtsn-b.deep_arg.t)&&(b.dps.savtsn=b.deep_arg.t,ba=b.dps.zmos+zns*b.deep_arg.t,aa=ba+2*zes*Math.sin(ba),E=Math.sin(aa),
C=0.5*E*E-0.25,D=-0.5*E*Math.cos(aa),tb=b.dps.se2*C+b.dps.se3*D,vb=b.dps.si2*C+b.dps.si3*D,xb=b.dps.sl2*C+b.dps.sl3*D+b.dps.sl4*E,b.dps.sghs=b.dps.sgh2*C+b.dps.sgh3*D+b.dps.sgh4*E,b.dps.shs=b.dps.sh2*C+b.dps.sh3*D,ba=b.dps.zmol+znl*b.deep_arg.t,aa=ba+2*zel*Math.sin(ba),E=Math.sin(aa),C=0.5*E*E-0.25,D=-0.5*E*Math.cos(aa),sb=b.dps.ee2*C+b.dps.e3*D,Ya=b.dps.xi2*C+b.dps.xi3*D,wb=b.dps.xl2*C+b.dps.xl3*D+b.dps.xl4*E,b.dps.sghl=b.dps.xgh2*C+b.dps.xgh3*D+b.dps.xgh4*E,b.dps.sh1=b.dps.xh2*C+b.dps.xh3*D,b.dps.pe=
tb+sb,b.dps.pinc=vb+Ya,b.dps.pl=xb+wb),ha=b.dps.sghs+b.dps.sghl,O=b.dps.shs+b.dps.sh1,b.deep_arg.xinc+=b.dps.pinc,b.deep_arg.em+=b.dps.pe,0.2<=b.dps.xqncl?(O/=b.deep_arg.sinio,ha-=b.deep_arg.cosio*O,b.deep_arg.omgadf+=ha,b.deep_arg.xnode+=O,b.deep_arg.xll+=b.dps.pl):(u=Math.sin(b.deep_arg.xnode),ta=Math.cos(b.deep_arg.xnode),r=y*u,ra=y*ta,Za=O*ta+b.dps.pinc*sa*u,cb=-O*u+b.dps.pinc*sa*ta,r+=Za,ra+=cb,b.deep_arg.xnode=FMod2p(b.deep_arg.xnode),wa=b.deep_arg.xll+b.deep_arg.omgadf+sa*b.deep_arg.xnode,
db=b.dps.pl+ha-b.dps.pinc*b.deep_arg.xnode*y,wa+=db,Ga=b.deep_arg.xnode,b.deep_arg.xnode=AcTan(r,ra),fabs(Ga-b.deep_arg.xnode)>pi&&(b.deep_arg.xnode=b.deep_arg.xnode<Ga?b.deep_arg.xnode+twopi:b.deep_arg.xnode-twopi),b.deep_arg.xll+=b.dps.pl,b.deep_arg.omgadf=wa-b.deep_arg.xll-Math.cos(b.deep_arg.xinc)*b.deep_arg.xnode)}}var Flags=0;function isFlagSet(a){return Flags&a}function isFlagClear(a){return~Flags&a}function SetFlag(a){Flags|=a}function ClearFlag(a){Flags&=~a}
function pass_t(){this.satname="";this.sat=null;this.maxel_az=this.orbit=this.los_az=this.aos_az=this.max_el=this.los=this.tca=this.aos=0;this.details=[]}function pass_detail_t(){this.time=0;this.pos=new vector_t;this.vel=new vector_t;this.orbit=this.footprint=this.phase=this.ma=this.alt=this.lon=this.lat=this.range_rate=this.range=this.el=this.az=this.velo=0}
function predict_calc(a,b,d){var e=new obs_set_t,c=new geodetic_t,f=new geodetic_t,g=0;f.lon=b.lon*de2ra;f.lat=b.lat*de2ra;f.alt=b.alt/1E3;f.theta=0;a.jul_utc=d;a.tsince=(a.jul_utc-a.jul_epoch)*xmnpda;a.flags&DEEP_SPACE_EPHEM_FLAG?SDP4(a,a.tsince):SGP4(a,a.tsince);Convert_Sat_State(a.pos,a.vel);Magnitude(a.vel);a.velo=a.vel.w;Calculate_Obs(a.jul_utc,a.pos,a.vel,f,e);for(Calculate_LatLonAlt(a.jul_utc,a.pos,c);c.lon<-pi;)c.lon+=twopi;for(;c.lon>pi;)c.lon-=twopi;a.az=Degrees(e.az);a.el=Degrees(e.el);
a.range=e.range;a.range_rate=e.range_rate;a.ssplat=Degrees(c.lat);a.ssplon=Degrees(c.lon);a.alt=c.alt;a.ma=Degrees(a.phase);a.ma*=256/360;a.phase=Degrees(a.phase);a.footprint=12756.33*acos(xkmper/(xkmper+a.alt));g=a.jul_utc-a.jul_epoch;a.orbit=floor((a.tle.xno*xmnpda/twopi+g*a.tle.bstar*ae)*g+a.tle.xmo/twopi)+a.tle.revnum-1}
function find_aos(a,b,d,e){var c=d,f=0;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;0<a.el&&(c=find_los(a,b,d,e)+0.014);if(0.1>c)return 0;predict_calc(a,b,c);if(0<e){for(;-1>a.el&&c<=d+e;)c-=3.5E-4*(a.el*(a.alt/8400+0.46)-2),predict_calc(a,b,c);for(;0==f&&c<=d+e;)0.005>fabs(a.el)?f=c:(c-=a.el*sqrt(a.alt)/53E4,predict_calc(a,b,c))}else{for(;-1>a.el;)c-=3.5E-4*(a.el*(a.alt/8400+0.46)-2),predict_calc(a,b,c);for(;0==f;)0.005>fabs(a.el)?f=c:(c-=a.el*
sqrt(a.alt)/53E4,predict_calc(a,b,c))}return f}
function find_los(a,b,d,e){var c=d,f=0;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;0>a.el&&(c=find_aos(a,b,d,e)+0.001);if(0.01>c)return 0;predict_calc(a,b,c);if(0<e){for(;1<=a.el&&c<=d+e;)c+=cos((a.el-1)*de2ra)*sqrt(a.alt)/25E3,predict_calc(a,b,c);for(;0==f&&c<=d+e;)c+=a.el*sqrt(a.alt)/502500,predict_calc(a,b,c),0.005>fabs(a.el)&&(f=c)}else{for(;1<=a.el;)c+=cos((a.el-1)*de2ra)*sqrt(a.alt)/25E3,predict_calc(a,b,c);for(;0==f;)c+=a.el*sqrt(a.alt)/
502500,predict_calc(a,b,c),0.005>fabs(a.el)&&(f=c)}return f}function find_prev_aos(a,b,d){var e=d;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;for(;0<=a.el;)e-=5E-4,predict_calc(a,b,e);return e}function get_next_passes(a,b,d,e){var c=Julian_Date(new Date);return get_passes(a,b,c,d,e)}
function get_pass(a,b,d,e,c){for(var f=0,g=0,l=0,n=0,n=0,t=d,p=0,q=0,k,n=!1,r=0,p=SAT_CFG_INT_PRED_RESOLUTION/86400;!n;)if(l=find_los(a,b,t,e),f=find_aos(a,b,t,e),f>l&&(f=find_prev_aos(a,b,t)),0==f)n=!0;else if(0<e&&f>d+e)n=!0;else{n=l-f;n/=SAT_CFG_INT_PRED_NUM_ENTRIES;n<p&&(n=p);c=new pass_t;c.sat=a;c.aos=f;c.los=l;c.satname=a.nickname;for(f=c.aos;f<=c.los;f+=n)predict_calc(a,b,f),f==c.aos&&(c.aos_az=a.az,c.orbit=a.orbit),k=new pass_detail_t,k.time=f,k.pos.x=a.pos.x,k.pos.y=a.pos.y,k.pos.z=a.pos.z,
k.pos.w=a.pos.w,k.vel.x=a.vel.x,k.vel.y=a.vel.y,k.vel.z=a.vel.z,k.vel.w=a.vel.w,k.velo=a.velo,k.az=a.az,k.el=a.el,k.range=a.range,k.range_rate=a.range_rate,k.lat=a.ssplat,k.lon=a.ssplon,k.alt=a.alt,k.ma=a.ma,k.phase=a.phase,k.footprint=a.footprint,k.orbit=a.orbit,c.details.push(k),a.el>q&&(q=a.el,g=f,c.maxel_az=a.az);predict_calc(a,b,c.los);c.los_az=a.az;c.max_el=q;c.tca=g;q>=SAT_CFG_INT_PRED_MIN_EL?n=!0:(n=!1,t=l+0.014,c=null);r++}return c}
function get_passes(a,b,d,e,c){var f=[],g,l,n;0==c&&(c=100);n=d;for(l=0;l<c;l++)g=get_pass(a,b,n,e),null!=g?(f.push(g),n=g.los+0.014,0<e&&n>=d+e&&(l=c)):l=c;return f}function Julian_Date_of_Epoch(a){var b;b=Int(0.001*a);a=1E3*Frac(0.001*a);return Julian_Date_of_Year(57>b?b+2E3:b+1900)+a}function Epoch_Time(a){var b,d=new tm;Calendar_Date(a,d);b=d.getUTCFullYear()%100;a=Frac(a+0.5);return 1E3*b+DOY(d.getUTCFullYear(),d.getUTCMonth()+1,d.getUTCDate())+a}
function DOY(a,b,d){var e=[31,28,31,30,31,30,31,31,30,31,30,31],c,f;for(c=f=0;c<b-1;c++)f+=e[c];f+=d;0==a%4&&((0!=a%100||0==a%400)&&2<b)&&f++;return f}function Fraction_of_Day(a,b,d){return(a+(b+d/60)/60)/24}
function Calendar_Date(a,b){var d,e,c,f,g;d=0.5/secday/1E3;g=Frac(a+0.5);1<=g+d&&(a+=d,g=0);d=Round(a);2299161>d||(e=Int((d-1867216.25)/36524.25),d=d+1+e-Int(e/4));c=d+1524;d=Int((c-122.1)/365.25);f=Int(365.25*d);e=Int((c-f)/30.6001);g=c-f-Int(30.6001*e)+g;e=13.5>e?Round(e-1):Round(e-13);b.setUTCFullYear(Int(2.5<e?d-4716:d-4715));b.setUTCMonth(e-1);b.setUTCDate(floor(g))}
function Time_of_Day(a,b){var d,e,c;c=Frac(a-0.5)*secday;c=Round(c);d=floor(c/3600);c-=3600*d;24==d&&(d=0);e=floor(c/60);c-=60*e;b.setUTCHours(d);b.setUTCMinutes(e);b.setUTCSeconds(c)}function Julian_Date(a){return Julian_Date_of_Year(a.getUTCFullYear())+DOY(a.getUTCFullYear(),a.getUTCMonth()+1,a.getUTCDate())+Fraction_of_Day(a.getUTCHours(),a.getUTCMinutes(),a.getUTCSeconds())}function Date_Time(a){return new Date(864E5*(a-2440587.5))}
function Delta_ET(a){return 26.465+0.747622*(a-1950)+1.886913*sin(twopi*(a-1975)/33)}function Julian_Date_of_Year(a){var b,d;a-=1;b=d=Int(a/100);d=Int(b/4);b=2-b+d;d=Int(365.25*a);d+=Int(428.4014);return d+1720994.5+b}
function ThetaG(a,b){var d,e,c;d=Int(0.001*a);e=1E3*Frac(0.001*a);d=57>d?d+2E3:d+1900;c=Frac(e);e=Int(e);d=Julian_Date_of_Year(d)+e;e=(d-2451545)/36525;Modulus(24110.54841+e*(8640184.812866+e*(0.093104-6.2E-6*e))+secday*omega_E*c,secday);b.ds50=d-2433281.5+c;return FMod2p(6.3003880987*b.ds50+1.72944494)}function ThetaG_JD(a){var b;b=Frac(a+0.5);a=(a-b-2451545)/36525;b=Modulus(24110.54841+a*(8640184.812866+a*(0.093104-6.2E-6*a))+secday*omega_E*b,secday);return twopi*b/secday}
function Calculate_User_PosVel(a,b,d,e){var c;b.theta=(ThetaG_JD(a)+b.lon)%twopi;c=1/Math.sqrt(1+__f*(__f-2)*Sqr(sin(b.lat)));a=Sqr(1-__f)*c;c=(xkmper*c+b.alt)*Math.cos(b.lat);d.x=c*Math.cos(b.theta);d.y=c*Math.sin(b.theta);d.z=(xkmper*a+b.alt)*Math.sin(b.lat);e.x=-mfactor*d.y;e.y=mfactor*d.x;e.z=0;Magnitude(d);Magnitude(e)}
function Calculate_LatLonAlt(a,b,d){var e,c,f;d.theta=AcTan(b.y,b.x);d.lon=FMod2p(d.theta-ThetaG_JD(a));a=sqrt(Sqr(b.x)+Sqr(b.y));e=__f*(2-__f);d.lat=AcTan(b.z,a);do c=d.lat,f=1/sqrt(1-e*Sqr(sin(c))),d.lat=AcTan(b.z+xkmper*f*e*Math.sin(c),a);while(1E-10<=fabs(d.lat-c));d.alt=a/Math.cos(d.lat)-xkmper*f;d.lat>pio2&&(d.lat-=twopi)}
function Calculate_Obs(a,b,d,e,c){var f,g;g=new vector_t;f=new vector_t;var l=new vector_t,n=new vector_t;Calculate_User_PosVel(a,e,g,f);l.x=b.x-g.x;l.y=b.y-g.y;l.z=b.z-g.z;n.x=d.x-f.x;n.y=d.y-f.y;n.z=d.z-f.z;Magnitude(l);a=Math.sin(e.lat);b=Math.cos(e.lat);d=Math.sin(e.theta);f=Math.cos(e.theta);e=a*f*l.x+a*d*l.y-b*l.z;g=-d*l.x+f*l.y;b=b*f*l.x+b*d*l.y+a*l.z;a=atan(-g/e);0<e&&(a+=pi);0>a&&(a+=twopi);e=ArcSin(b/l.w);c.az=a;c.el=e;c.range=l.w;c.range_rate=Dot(l,n)/l.w;0<=c.el?SetFlag(VISIBLE_FLAG):
(c.el=e,ClearFlag(VISIBLE_FLAG))}function Calculate_RADec_and_Obs(a,b,d,e,c){var f,g,l,n;g=new obs_set_t;Calculate_Obs(a,b,d,e,g);b=g.az;g=g.el;f=e.lat;e=FMod2p(ThetaG_JD(a)+e.lon);a=Math.sin(e);d=Math.cos(e);e=Math.sin(f);f=Math.cos(f);l=-cos(b)*Math.cos(g);n=Math.sin(b)*Math.cos(g);g=Math.sin(g);b=e*d*l+-a*n+d*f*g;a=e*a*l+d*n+a*f*g;e=-f*l+0*n+e*g;c.dec=ArcSin(e);e=sqrt(1-Sqr(e));c.ra=AcTan(a/e,b/e);c.ra=FMod2p(c.ra)}
var sin=Math.sin,cos=Math.cos,sqrt=Math.sqrt,floor=Math.floor,pow=Math.pow,fabs=Math.abs,acos=Math.acos,asin=Math.asin,atan=Math.atan;function gtk_sat_data_read_sat(a,b){Convert_Satellite_Data(a,b.tle);b.name=b.tle.sat_name.trim();b.nickname=b.name;b.flags=0;select_ephemeris(b);b.jul_utc=0;b.tsince=0;b.az=0;b.el=0;b.range=0;b.range_rate=0;b.ra=0;b.dec=0;b.ssplat=0;b.ssplon=0;b.alt=0;b.velo=0;b.ma=0;b.footprint=0;b.phase=0;b.aos=0;b.los=0;gtk_sat_data_init_sat(b)}
function gtk_sat_data_init_sat(a){var b=new geodetic_t,d;d=Julian_Date_of_Epoch(a.tle.epoch);a.jul_epoch=d;a.flags&DEEP_SPACE_EPHEM_FLAG?SDP4(a,0):SGP4(a,0);Convert_Sat_State(a.pos,a.vel);Magnitude(a.vel);a.velo=a.vel.w;for(Calculate_LatLonAlt(d,a.pos,b);b.lon<-pi;)b.lon+=twopi;for(;b.lon>pi;)b.lon-=twopi;a.ssplat=Degrees(b.lat);a.ssplon=Degrees(b.lon);a.alt=b.alt;a.ma=Degrees(a.phase);a.ma*=256/360;a.footprint=2*xkmper*acos(xkmper/a.pos.w);a.orbit=floor(0*(a.tle.xno*xmnpda/twopi+0*a.tle.bstar*ae)+
a.tle.xmo/twopi)+a.tle.revnum-1;a.otype=get_orbit_type(a)}function qth_t(){this.alt=this.lon=this.lat=0}function Sign(a){return 0<a?1:0>a?-1:0}function Sqr(a){return a*a}function Cube(a){return a*a*a}function Radians(a){return a*de2ra}function Degrees(a){return a/de2ra}var ArcSin=Math.asin,ArcCos=Math.acos;function arccos(a,b){if(a&&b){if(0<b)return Math.acos(a/b);if(0>b)return pi+Math.acos(a/b)}return 0}function Magnitude(a){a.w=sqrt(Sqr(a.x)+Sqr(a.y)+Sqr(a.z))}
function Vec_Add(a,b,d){d.x=a.x+b.x;d.y=a.y+b.y;d.z=a.z+b.z;Magnitude(d)}function Vec_Sub(a,b,d){d.x=a.x-b.x;d.y=a.y-b.y;d.z=a.z-b.z;Magnitude(d)}function Scalar_Multiply(a,b,d){d.x=a*b.x;d.y=a*b.y;d.z=a*b.z;d.w=fabs(a)*b.w}function Scale_Vector(a,b){b.x*=a;b.y*=a;b.z*=a;Magnitude(b)}function Dot(a,b){return a.x*b.x+a.y*b.y+a.z*b.z}function Angle(a,b){Magnitude(a);Magnitude(b);return ArcCos(Dot(a,b)/(a.w*b.w))}
function Cross(a,b,d){d.x=a.y*b.z-a.z*b.y;d.y=a.z*b.x-a.x*b.z;d.z=a.x*b.y-a.y*b.x;Magnitude(d)}function Normalize(a){a.x/=a.w;a.y/=a.w;a.z/=a.w}var AcTan=Math.atan2;function FMod2p(a){return a%twopi}function Modulus(a,b){return a%b}function Frac(a){return a-floor(a)}var Round=Math.round,Int=Math.floor;function Convert_Sat_State(a,b){Scale_Vector(xkmper,a);Scale_Vector(xkmper*xmnpda/secday,b)}
function pass_t(){this.satname="";this.sat=null;this.maxel_az=this.orbit=this.los_az=this.aos_az=this.max_el=this.los=this.tca=this.aos=0;this.details=[]}function pass_detail_t(){this.time=0;this.pos=new vector_t;this.vel=new vector_t;this.orbit=this.footprint=this.phase=this.ma=this.alt=this.lon=this.lat=this.range_rate=this.range=this.el=this.az=this.velo=0}
function predict_calc(a,b,d){var e=new obs_set_t,c=new geodetic_t,f=new geodetic_t,g=0;f.lon=b.lon*de2ra;f.lat=b.lat*de2ra;f.alt=b.alt/1E3;f.theta=0;a.jul_utc=d;a.tsince=(a.jul_utc-a.jul_epoch)*xmnpda;a.flags&DEEP_SPACE_EPHEM_FLAG?SDP4(a,a.tsince):SGP4(a,a.tsince);Convert_Sat_State(a.pos,a.vel);Magnitude(a.vel);a.velo=a.vel.w;Calculate_Obs(a.jul_utc,a.pos,a.vel,f,e);for(Calculate_LatLonAlt(a.jul_utc,a.pos,c);c.lon<-pi;)c.lon+=twopi;for(;c.lon>pi;)c.lon-=twopi;a.az=Degrees(e.az);a.el=Degrees(e.el);
a.range=e.range;a.range_rate=e.range_rate;a.ssplat=Degrees(c.lat);a.ssplon=Degrees(c.lon);a.alt=c.alt;a.ma=Degrees(a.phase);a.ma*=256/360;a.phase=Degrees(a.phase);a.footprint=12756.33*acos(xkmper/(xkmper+a.alt));g=a.jul_utc-a.jul_epoch;a.orbit=floor((a.tle.xno*xmnpda/twopi+g*a.tle.bstar*ae)*g+a.tle.xmo/twopi)+a.tle.revnum-1}
function find_aos(a,b,d,e){var c=d,f=0;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;0<a.el&&(c=find_los(a,b,d,e)+0.014);if(0.1>c)return 0;predict_calc(a,b,c);if(0<e){for(;-1>a.el&&c<=d+e;)c-=3.5E-4*(a.el*(a.alt/8400+0.46)-2),predict_calc(a,b,c);for(;0==f&&c<=d+e;)0.005>fabs(a.el)?f=c:(c-=a.el*sqrt(a.alt)/53E4,predict_calc(a,b,c))}else{for(;-1>a.el;)c-=3.5E-4*(a.el*(a.alt/8400+0.46)-2),predict_calc(a,b,c);for(;0==f;)0.005>fabs(a.el)?f=c:(c-=a.el*
sqrt(a.alt)/53E4,predict_calc(a,b,c))}return f}
function find_los(a,b,d,e){var c=d,f=0;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;0>a.el&&(c=find_aos(a,b,d,e)+0.001);if(0.01>c)return 0;predict_calc(a,b,c);if(0<e){for(;1<=a.el&&c<=d+e;)c+=cos((a.el-1)*de2ra)*sqrt(a.alt)/25E3,predict_calc(a,b,c);for(;0==f&&c<=d+e;)c+=a.el*sqrt(a.alt)/502500,predict_calc(a,b,c),0.005>fabs(a.el)&&(f=c)}else{for(;1<=a.el;)c+=cos((a.el-1)*de2ra)*sqrt(a.alt)/25E3,predict_calc(a,b,c);for(;0==f;)c+=a.el*sqrt(a.alt)/
502500,predict_calc(a,b,c),0.005>fabs(a.el)&&(f=c)}return f}function find_prev_aos(a,b,d){var e=d;predict_calc(a,b,d);if(a.otype==ORBIT_TYPE_GEO||a.otype==ORBIT_TYPE_DECAYED||!has_aos(a,b))return 0;for(;0<=a.el;)e-=5E-4,predict_calc(a,b,e);return e}function get_next_passes(a,b,d,e){var c=Julian_Date(new Date);return get_passes(a,b,c,d,e)}
function get_pass(a,b,d,e,c){for(var f=0,g=0,l=0,n=0,n=0,t=d,p=0,q=0,k,n=!1,r=0,p=SAT_CFG_INT_PRED_RESOLUTION/86400;!n;)if(l=find_los(a,b,t,e),f=find_aos(a,b,t,e),f>l&&(f=find_prev_aos(a,b,t)),0==f)n=!0;else if(0<e&&f>d+e)n=!0;else{n=l-f;n/=SAT_CFG_INT_PRED_NUM_ENTRIES;n<p&&(n=p);c=new pass_t;c.sat=a;c.aos=f;c.los=l;c.satname=a.nickname;for(f=c.aos;f<=c.los;f+=n)predict_calc(a,b,f),f==c.aos&&(c.aos_az=a.az,c.orbit=a.orbit),k=new pass_detail_t,k.time=f,k.pos.x=a.pos.x,k.pos.y=a.pos.y,k.pos.z=a.pos.z,
k.pos.w=a.pos.w,k.vel.x=a.vel.x,k.vel.y=a.vel.y,k.vel.z=a.vel.z,k.vel.w=a.vel.w,k.velo=a.velo,k.az=a.az,k.el=a.el,k.range=a.range,k.range_rate=a.range_rate,k.lat=a.ssplat,k.lon=a.ssplon,k.alt=a.alt,k.ma=a.ma,k.phase=a.phase,k.footprint=a.footprint,k.orbit=a.orbit,c.details.push(k),a.el>q&&(q=a.el,g=f,c.maxel_az=a.az);predict_calc(a,b,c.los);c.los_az=a.az;c.max_el=q;c.tca=g;q>=SAT_CFG_INT_PRED_MIN_EL?n=!0:(n=!1,t=l+0.014,c=null);r++}return c}
function get_passes(a,b,d,e,c){var f=[],g,l,n;0==c&&(c=100);n=d;for(l=0;l<c;l++)g=get_pass(a,b,n,e),null!=g?(f.push(g),n=g.los+0.014,0<e&&n>=d+e&&(l=c)):l=c;return f};
